# License Plate Detection and Recording System Configuration

detection:
  # YOLO TensorRT model configuration
  engine_path: "/etc/recorder/models/car_lpd_11nv6.engine"  # Path to detection TensorRT engine
  confidence_threshold: 0.50                            # Minimum confidence for detections
  iou_threshold: 0.35                                  # IoU threshold for NMS
  detection_input_size: 640                            # Input size for detection model
  max_det: 300                                         # Maximum detections per image
  
  # OCR TensorRT configuration
  enable_ocr: true
  ocr_engine_path: "/etc/recorder/models/fast_plate_ocr/cct-s-v1-global-model/cct_s_v1_global_fp16.trt"
  ocr_config_path: "/etc/recorder/models/fast_plate_ocr/cct-s-v1-global-model/cct_s_v1_global_plate_config.yaml"

recording:
  # Recording timing (in seconds)
  pre_plate_buffer: 3      # Seconds before plate detection to include
  post_plate_buffer: 5     # Seconds after plate detection to include
  max_duration: 30         # Maximum recording duration in seconds

  # Output settings
  output_dir: "/mnt/data/recorder/recordings"
  video_codec: "mp4v"      # Video codec for output files
  default_fps: 30          # Default FPS if detection fails

# S3 Upload Configuration (Backblaze B2)
s3_upload:
  enabled: true                    # Enable/disable S3 uploads
  bucket: "bmx-dev-lpr-recordings"  # S3 bucket name
  endpoint: "s3.us-east-005.backblazeb2.com"  # Backblaze B2 endpoint
  access_key_id: ""  # Set via S3_ACCESS_KEY_ID env var (do not hardcode)
  secret_access_key: ""  # Set via S3_SECRET_ACCESS_KEY env var (do not hardcode)
  prefix: "recordings"              # S3 key prefix (folder path)
  delete_after_upload: true         # Delete local files after successful upload
  max_retries: 3                    # Maximum upload retry attempts
  retry_delay: 5.0                  # Delay between retries in seconds

tracking:
  # ByteTracker settings
  track_thresh: 0.3              # Detection confidence threshold for tracking
  track_buffer: 90               # Number of frames to keep lost tracks (6 seconds at 15fps)
  match_thresh: 0.2              # IoU threshold for bbox matching (relaxed for fast motion)

  # License plate specific tracking
  confidence_aggregation: true   # Enable OCR aggregation for better accuracy
  min_detections_for_recording: 3  # Trigger recording after 3 consistent OCR detections
  
  # Duplicate recording prevention (fuzzy matching within same track only)
  # OCR variations (ABC123 vs ABC1Z3) won't trigger duplicates within same track
  # Each new track can record independently, even if same plate or within 5 minutes

stream:
  # RTSP configuration
  rtsp_url: "rtsp://camera_ip/stream"
  reconnect_delay: 5           # Initial seconds to wait before reconnecting
  connection_timeout: 10       # Connection timeout in seconds
  max_reconnect_attempts: 10   # Maximum number of reconnection attempts
  transport: tcp               # Use TCP for reliable transport

logging:
  level: DEBUG
  file: /mnt/data/recorder/logs/license_plate_recorder.log